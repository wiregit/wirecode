<?xml version="1.0"?>
<project name="MojitoDHT" default="buildall" basedir=".">
    <description>MojitoDHT</description>

    <property name="basedir" value="."/>
    <property name="src" value="${basedir}/src/java"/>
	<property name="test" value="${basedir}/src/test"/>
	<property name="misc" value="${basedir}/src/misc"/>
	
    <property name="coredir" value="../core"/>
	<property name="guidir" value="../gui"/>
    <property name="lib" value="../lib"/>
    <property name="jars" value="${lib}/jars"/>
    <property name="miscjars" value="${basedir}/lib/misc"/>
	
    <path id="default.classpath" >
        <fileset dir="${jars}" includes="**/*.jar"/>
        <fileset dir="${miscjars}" includes="**/*.jar"/>
    	<pathelement location="${coredir}" />
    </path>

    <target name="build">
        <javac srcdir="${src}" 
				destdir="${src}"
		    		target="1.5"
		    		source="1.5"
	    			compiler="javac1.5"
		    		debug="true"
	    			optimize="false">
            <classpath refid="default.classpath" />
        </javac>
    	
    	<javac srcdir="${misc}" 
				destdir="${misc}"
		    		target="1.5"
		    		source="1.5"
	    			compiler="javac1.5"
		    		debug="true"
	    			optimize="false">
            <classpath refid="default.classpath" />
    		<classpath>
	      		<pathelement path="${src}"/>
		    </classpath>
        </javac>
    </target>

    <target name="buildall">
        <javac destdir="${src}" 
	            target="1.5" 
	            source="1.5" 
	            compiler="javac1.5" 
	            debug="true" 
	            optimize="false">
            <src path="${src}" />
            <src path="${coredir}" />
            <classpath refid="default.classpath"/>
        </javac>
    	
    	<javac srcdir="${misc}" 
				destdir="${misc}"
		    		target="1.5"
		    		source="1.5"
	    			compiler="javac1.5"
		    		debug="true"
	    			optimize="false">
            <classpath refid="default.classpath" />
    		<classpath>
	      		<pathelement path="${src}"/>
		    </classpath>
        </javac>
    	
    	<move todir="${coredir}">
			<fileset dir="${src}">
				<exclude name="**/mojito/**"/>
			</fileset>
		</move>
    </target>
	
    <target name="clean">
        <delete>
            <fileset dir="${src}" includes="**/*.class"/>
        	<fileset dir="${misc}" includes="**/*.class"/>
        	<fileset dir="${test}" includes="**/*.class"/>
        	<fileset dir="${coredir}" includes="**/*.class"/>
        </delete>
    </target>

    <target name="jar" depends="clean, buildall">
        <delete file="mojito.jar"/>
        <jar destfile="mojito.jar" 
				basedir="${src}"
				includes="**/*.class"
				compress="false">
        </jar>
    	<jar destfile="mojito.jar" 
    			update="true"
				basedir="${misc}"
				includes="**/*.class"
				compress="false">
	    </jar>
    	
    	<delete file="core.jar"/>
        <jar destfile="core.jar" 
				basedir="${coredir}"
				includes="**/*.class"
				compress="false">
        </jar>
    </target>
</project>

