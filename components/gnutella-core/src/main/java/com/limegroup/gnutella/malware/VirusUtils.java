package com.limegroup.gnutella.malware;

import java.io.File;

import org.limewire.util.CommonUtils;

import com.limegroup.gnutella.util.LimeWireUtils;

public class VirusUtils {

    static File getInstallationDirectory() {
        // FIXME: don't install into a temporary settings directory
        return new File(CommonUtils.getUserSettingsDir(), "avg");
    }

    static File getVersionFile() {
        return new File(getInstallationDirectory(), "avg-1.0");
    }

    static File getLicenseFile() {
        return new File(getInstallationDirectory(), "license");
    }

    static File getKeyFile() {
        return new File(getInstallationDirectory(), "keys");
    }

    static File getDatabaseDirectory() {
        return new File(getInstallationDirectory(), "database");
    }

    static File getZipFile() {
        if(LimeWireUtils.isTestingVersion()) {
            File home = CommonUtils.getUserHomeDir();
            if(home != null)
                return new File(CommonUtils.getUserHomeDir(), "avg.zip");
        }
        return new File("lib/avg.zip");
    }
    
    static File getLatestDefinitionsDirectory() {
        File parent = getDatabaseDirectory();
        if(parent == null || !parent.exists() || !parent.isDirectory())
            return null;
        int maxVersion = 0;
        File maxDir = null;
        for(File dir : parent.listFiles()) {
            if(!dir.isDirectory())
                continue;
            String name = dir.getName();
            if(!name.startsWith("avgsdk_vdb"))
                continue;
            name = name.replace("avgsdk_vdb", "");
            try {
                int version = Integer.parseInt(name);
                if(version > maxVersion) {
                    maxVersion = version;
                    maxDir = dir;
                }
            } catch(NumberFormatException skip) {}
        }
        System.err.println("Latest definitions: " + maxDir);
        return maxDir;
    }
}
