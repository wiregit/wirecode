package com.limegroup.gnutella.security;

import java.security.SignatureException;

import junit.framework.Test;

import org.limewire.util.BaseTestCase;

public class CertificateVerifierImplTest extends BaseTestCase {
    
    private CertificateVerifierImpl certificateVerifierImpl;

    public static Test suite() {
        return buildTestSuite(CertificateVerifierImplTest.class);
    }
    
    @Override
    protected void setUp() throws Exception {
        certificateVerifierImpl = new CertificateVerifierImpl("GCBADOBQQIASYBQHFKDERTRYAQATBAQBD4BIDAIA7V7VHAI5OUJCSUW7JKOC53HE473BDN2SHTXUIAGDDY7YBNSREZUUKXKAEJI7WWJ5RVMPVP6F6W5DB5WLTNKWZV4BHOAB2NDP6JTGBN3LTFIKLJE7T7UAI6YQELBE7O5J277LPRQ37A5VPZ6GVCTBKDYE7OB7NU6FD3BQENKUCNNBNEJS6Z27HLRLMHLSV37SEIBRTHORJAA4OAQVACLWAUEPCURQXTFSSK4YFIXLQQF7AWA46UBIDAIA67Q2BBOWTM655S54VNODNOCXXF4ZJL537I5OVAXZK5GAWPIHQJTVCWKXR25NIWKP4ZYQOEEBQC2ESFTREPUEYKAWCO346CJSRTEKNYJ4CZ5IWVD4RUUOBI5ODYV3HJTVSFXKG7YL7IQTKYXR7NRHUAJEHPGKJ4N6VBIZBCNIQPP6CWXFT4DJFC3GL2AHWVJFMQAUYO76Z5ESUA4BQUAAFAMBADRAMTBWOA43OM6DE3H4U3OYATOWNG7EO4G52MWL4W2SXBQQAG5AKFI2GGOUL7HCH734WYYX33TT27MPJWOO424YA4LK3HWHNKJB66R736VBH2ATYTK223AVJP2LNZUIRDGHU2CDAYQ2O6SEO3SLIX5DYHITRPJX7JMX6IMKRLBTOSOZMDU2VRJXG5K3JNPNAIYR5CPLYINZK7A");
    }
    
    public void testVerifyValidCertificate() throws Exception {
        Certificate certificate = new CertificateParserImpl().parseCertificate("GAWQEFIARSGMFXPFJZLZZMNQCYIT5VG66O7NWP6VAIKFJ6SZ2E2AJRHTD63UXONQT36SA5X7F7OA|1|GCBADNZQQIASYBQHFKDERTRYAQATBAQBD4BIDAIA7V7VHAI5OUJCSUW7JKOC53HE473BDN2SHTXUIAGDDY7YBNSREZUUKXKAEJI7WWJ5RVMPVP6F6W5DB5WLTNKWZV4BHOAB2NDP6JTGBN3LTFIKLJE7T7UAI6YQELBE7O5J277LPRQ37A5VPZ6GVCTBKDYE7OB7NU6FD3BQENKUCNNBNEJS6Z27HLRLMHLSV37SEIBRTHORJAA4OAQVACLWAUEPCURQXTFSSK4YFIXLQQF7AWA46UBIDAIA67Q2BBOWTM655S54VNODNOCXXF4ZJL537I5OVAXZK5GAWPIHQJTVCWKXR25NIWKP4ZYQOEEBQC2ESFTREPUEYKAWCO346CJSRTEKNYJ4CZ5IWVD4RUUOBI5ODYV3HJTVSFXKG7YL7IQTKYXR7NRHUAJEHPGKJ4N6VBIZBCNIQPP6CWXFT4DJFC3GL2AHWVJFMQAUYO76Z5ESUA4BQQAAFAMADGSCIYVEIUKQNN6A4D7B77A62EMIURPPHQE2ILP3GJLRTUSRSK2Q4IALFHHVMRA2HOERD25DUJXGX2IQDEAFWWLVG7FOHRG2Z3H4ER66UV2UVI7X5VG3UWGJ72ZW3V5V55ELJVJ52EAFCZW4WKUP2EAIUBDQYZ63LG5PFXYY5N2RHKJOU6UUAJZUV3VTGZNFDIU6G3BMMIIDG"); 
        assertSame(certificate, certificateVerifierImpl.verify(certificate));
    }
    
    public void testVerifyInvalidCertificate() throws Exception {
        // changed version number
        Certificate certificate = new CertificateParserImpl().parseCertificate("GAWQEFIARSGMFXPFJZLZZMNQCYIT5VG66O7NWP6VAIKFJ6SZ2E2AJRHTD63UXONQT36SA5X7F7OA|2|GCBADNZQQIASYBQHFKDERTRYAQATBAQBD4BIDAIA7V7VHAI5OUJCSUW7JKOC53HE473BDN2SHTXUIAGDDY7YBNSREZUUKXKAEJI7WWJ5RVMPVP6F6W5DB5WLTNKWZV4BHOAB2NDP6JTGBN3LTFIKLJE7T7UAI6YQELBE7O5J277LPRQ37A5VPZ6GVCTBKDYE7OB7NU6FD3BQENKUCNNBNEJS6Z27HLRLMHLSV37SEIBRTHORJAA4OAQVACLWAUEPCURQXTFSSK4YFIXLQQF7AWA46UBIDAIA67Q2BBOWTM655S54VNODNOCXXF4ZJL537I5OVAXZK5GAWPIHQJTVCWKXR25NIWKP4ZYQOEEBQC2ESFTREPUEYKAWCO346CJSRTEKNYJ4CZ5IWVD4RUUOBI5ODYV3HJTVSFXKG7YL7IQTKYXR7NRHUAJEHPGKJ4N6VBIZBCNIQPP6CWXFT4DJFC3GL2AHWVJFMQAUYO76Z5ESUA4BQQAAFAMADGSCIYVEIUKQNN6A4D7B77A62EMIURPPHQE2ILP3GJLRTUSRSK2Q4IALFHHVMRA2HOERD25DUJXGX2IQDEAFWWLVG7FOHRG2Z3H4ER66UV2UVI7X5VG3UWGJ72ZW3V5V55ELJVJ52EAFCZW4WKUP2EAIUBDQYZ63LG5PFXYY5N2RHKJOU6UUAJZUV3VTGZNFDIU6G3BMMIIDG"); 
        try {
            certificateVerifierImpl.verify(certificate);
            fail("exception expected");
        } catch (SignatureException se) {
        }
        // changed last character of signed payload
        certificate = new CertificateParserImpl().parseCertificate("GAWQEFIARSGMFXPFJZLZZMNQCYIT5VG66O7NWP6VAIKFJ6SZ2E2AJRHTD63UXONQT36SA5X7F7OA|2|GCBADNZQQIASYBQHFKDERTRYAQATBAQBD4BIDAIA7V7VHAI5OUJCSUW7JKOC53HE473BDN2SHTXUIAGDDY7YBNSREZUUKXKAEJI7WWJ5RVMPVP6F6W5DB5WLTNKWZV4BHOAB2NDP6JTGBN3LTFIKLJE7T7UAI6YQELBE7O5J277LPRQ37A5VPZ6GVCTBKDYE7OB7NU6FD3BQENKUCNNBNEJS6Z27HLRLMHLSV37SEIBRTHORJAA4OAQVACLWAUEPCURQXTFSSK4YFIXLQQF7AWA46UBIDAIA67Q2BBOWTM655S54VNODNOCXXF4ZJL537I5OVAXZK5GAWPIHQJTVCWKXR25NIWKP4ZYQOEEBQC2ESFTREPUEYKAWCO346CJSRTEKNYJ4CZ5IWVD4RUUOBI5ODYV3HJTVSFXKG7YL7IQTKYXR7NRHUAJEHPGKJ4N6VBIZBCNIQPP6CWXFT4DJFC3GL2AHWVJFMQAUYO76Z5ESUA4BQQAAFAMADGSCIYVEIUKQNN6A4D7B77A62EMIURPPHQE2ILP3GJLRTUSRSK2Q4IALFHHVMRA2HOERD25DUJXGX2IQDEAFWWLVG7FOHRG2Z3H4ER66UV2UVI7X5VG3UWGJ72ZW3V5V55ELJVJ52EAFCZW4WKUP2EAIUBDQYZ63LG5PFXYY5N2RHKJOU6UUAJZUV3VTGZNFDIU6G3BMMIIDC"); 
        try {
            certificateVerifierImpl.verify(certificate);
            fail("exception expected");
        } catch (SignatureException se) {
        }
        // changed signature 
        certificate = new CertificateParserImpl().parseCertificate("GAWQEFIARSGMFXPFJZLZZMNQCYIT5VG66O7NWP6VAIKFJ6SZ2E2AJRHTD63UXONQT36SA5X7F7OB|2|GCBADNZQQIASYBQHFKDERTRYAQATBAQBD4BIDAIA7V7VHAI5OUJCSUW7JKOC53HE473BDN2SHTXUIAGDDY7YBNSREZUUKXKAEJI7WWJ5RVMPVP6F6W5DB5WLTNKWZV4BHOAB2NDP6JTGBN3LTFIKLJE7T7UAI6YQELBE7O5J277LPRQ37A5VPZ6GVCTBKDYE7OB7NU6FD3BQENKUCNNBNEJS6Z27HLRLMHLSV37SEIBRTHORJAA4OAQVACLWAUEPCURQXTFSSK4YFIXLQQF7AWA46UBIDAIA67Q2BBOWTM655S54VNODNOCXXF4ZJL537I5OVAXZK5GAWPIHQJTVCWKXR25NIWKP4ZYQOEEBQC2ESFTREPUEYKAWCO346CJSRTEKNYJ4CZ5IWVD4RUUOBI5ODYV3HJTVSFXKG7YL7IQTKYXR7NRHUAJEHPGKJ4N6VBIZBCNIQPP6CWXFT4DJFC3GL2AHWVJFMQAUYO76Z5ESUA4BQQAAFAMADGSCIYVEIUKQNN6A4D7B77A62EMIURPPHQE2ILP3GJLRTUSRSK2Q4IALFHHVMRA2HOERD25DUJXGX2IQDEAFWWLVG7FOHRG2Z3H4ER66UV2UVI7X5VG3UWGJ72ZW3V5V55ELJVJ52EAFCZW4WKUP2EAIUBDQYZ63LG5PFXYY5N2RHKJOU6UUAJZUV3VTGZNFDIU6G3BMMIIDG"); 
        try {
            certificateVerifierImpl.verify(certificate);
            fail("exception expected");
        } catch (SignatureException se) {
        }
    }
    
    public void testVerifyNullCertificateFails() throws Exception {
        try {
            certificateVerifierImpl.verify(new NullCertificate());
            fail("exception expected");
        } catch (SignatureException se) {
        }
    }
}
