<project name="lw-core" default="compile" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">

    <property name="limewire.home" location="${basedir}/.."/>
    
    <import file="../components/build.xml"/>
    
    <target name="initialize" unless="initialized.core">
        <property name="initialized.core" 			  value="true"/>
        <property name="limewire.core.home"           location="${limewire.home}/core"/>
        <property name="limewire.core.src"  		  location="${limewire.core.home}"/>
        <property name="build.limewire.core.classes"  location="${limewire.core.home}"/>
        <property name="build.limewire.core.home.lib" location="${limewire.core.home}/lib"/>
        <path id="build.limewire.core.classpath">
            <fileset dir="${build.limewire.core.home.lib}/default/" includes="**/*"/>
        </path>
    </target>
    
    <!-- compiles the core & components -->
    <!-- TODO 
    <target name="compile-all"
            description="Compiles the components and the core."
            depends="initialize, lw-components.compile-core-src, compile-core"/ -->
    
	<!-- builds only the core -->
	<target name="compile-core" 
	        description="Compiles just the core."
	        depends="initialize">
        <ivy:configure file="${limewire.home}/ivysettings.xml" override="true"/>
        <ivy:resolve file="${limewire.core.home}/ivy.xml"/>
        <ivy:retrieve pattern="${build.limewire.core.home.lib}/[conf]/[type]/[artifact]-[version].[ext]"/>
	    <javac destdir      ="${build.limewire.core.classes}"
			   debug	    ="${compile.debug}"
			   deprecation  ="${compile.deprecation}"
	           optimize     ="${compile.optimize}"
			   encoding     ="UTF-8"
	           source		="${compile.source}"
	           target       ="${compile.target}"
	           srcdir	    ="${limewire.core.src}"
			   excludes		="examples/**"
	    >
			<classpath refid="build.limewire.core.classpath"/>
	   	</javac>
	</target>
    
    <!-- cleans the core & components -->
    <!-- TODO 
    <target name="clean-all" 
            description="Cleans the classfiles generated from compiling the components and core."
            depends="initialize, lw-components.clean-src, clean-core"/-->
	
	<!-- cleans only the core -->
	<target name="clean-core"
	        description="Cleans just the core classes."
            depends="initialize">
		<delete>
			<fileset dir="${build.limewire.core.classes}" includes="**/*.class"/>
            <fileset dir="${build.limewire.core.home.lib}" includes="**/*"/>
            <fileset dir="${limewire.core.home}/dist" includes="**/*"/>
		</delete>
	</target>
    
    <target name="clean" description="Cleans just the core" depends="clean-core"/>
    <target name="compile" description="Compiles just the core" depends="compile-core"/>
    
    <target name="jar" depends="initialize,compile-core">
        <mkdir dir="${limewire.core.home}/dist"/>
        <jar destfile="${limewire.core.home}/dist/core.jar"
            	 compress="@{compress}"
                 basedir="${build.limewire.core.classes}"
                 includes="**/*.class"
                 excludes="@{excludes}"
            >
            </jar>
        <ivy:configure file="${limewire.home}/ivysettings.xml" override="true"/>
        <ivy:publish resolver="local" overwrite="true" forcedeliver="true" artifactspattern="${limewire.core.home}/dist/core.jar" srcivypattern="${limewire.core.home}/dist/ivy.xml"/>
    </target>
    
    <!--
       everything below is just to erase the targets from 'ant -p'
       they are listed because we import the component's buildfile.
      -->
    <target name="clean-src"/>
    <target name="clean-dist"/>
    <target name="clean-tests"/>
    <target name="clover2html"/>
    <target name="compile-src"/>
    <target name="compile-core-src"/>
    <target name="compile-ui-src"/>
    <target name="compile-tests"/>
    <target name="javadoc"/>
    <target name="test"/>
    <target name="test-all"/>
    <target name="test-package"/>
    <target name="with.clover"/>

</project>














